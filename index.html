<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/logo.png" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#21DBA4" />
  <title>LinkBrain - AI Link Saver & Second Brain</title>
  <meta name="description"
    content="í©ì–´ì§„ ë§í¬ë“¤ì„ ëª¨ì•„ ë‘ ë²ˆì§¸ ë‡Œë¥¼ ë§Œë“œì„¸ìš”. LinkBrain(ë§í¬ë¸Œë ˆì¸)ì€ AI ê¸°ë°˜ ë§í¬ ì €ì¥, ìŠ¤ë ˆë“œ ì €ì¥, ìë™ ìš”ì•½ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤." />
  <meta name="keywords"
    content="LinkBrain, ë§í¬ë¸Œë ˆì¸, ë§í¬ì €ì¥, ìŠ¤ë ˆë“œ ì €ì¥, AI ë§í¬ ê´€ë¦¬, Second Brain, ì§€ì‹ ê´€ë¦¬, Link Saver, Thread Saver" />
  <meta property="og:site_name" content="LinkBrain" />

  <!-- PWA ë©”íƒ€ íƒœê·¸ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="LinkBrain">
  <link rel="apple-touch-icon" href="/icon-192x192.png">

  <script>
    (function () {
      try {
        var theme = localStorage.getItem('linkbrain-theme') || 'light';
        var bgColor = theme === 'dark' ? '#0f172a' : '#F8FAFC';
        document.documentElement.style.backgroundColor = bgColor;
        document.body && (document.body.style.backgroundColor = bgColor);
      } catch (e) { }
    })();
  </script>
  <style>
    html,
    body {
      background-color: #F8FAFC;
    }

    html.dark,
    body.dark {
      background-color: #0f172a;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <div id="modal-root" style="position: relative; z-index: 999999;"></div>
  <script type="module" src="/src/main.tsx"></script>

  <!-- PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ (React ì•±ì—ì„œ ê´€ë¦¬) -->
  <div id="pwa-install-prompt" style="display: none; position: fixed; bottom: 20px; right: 20px; z-index: 99999;">
    <div style="background: white; padding: 16px 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); border-left: 4px solid #21DBA4; max-width: 300px;">
      <div style="margin-bottom: 12px;">
        <strong style="color: #1f2937;">LinkBrainì„ ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ì„¸ìš”!</strong>
        <p style="margin: 4px 0 0 0; font-size: 13px; color: #666;">í™ˆ í™”ë©´ì—ì„œ ë°”ë¡œ ì ‘ê·¼í•˜ê³  ì˜¤í”„ë¼ì¸ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
      </div>
      <button id="pwa-install-button" style="width: 100%; padding: 10px; background: #21DBA4; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">ğŸ“± ì„¤ì¹˜í•˜ê¸°</button>
      <button id="pwa-dismiss-button" style="width: 100%; padding: 8px; background: transparent; color: #999; border: none; border-radius: 4px; cursor: pointer; margin-top: 6px; font-size: 12px;">ë‚˜ì¤‘ì—</button>
    </div>
  </div>

  <!-- Service Worker ë“±ë¡ & PWA ì„¤ì¹˜ ë¡œì§ -->
  <script>
    // Service Worker ë“±ë¡
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('[PWA] Service Worker registered:', reg.scope))
          .catch(err => console.log('[PWA] Service Worker registration failed:', err));
      });
    }

    // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ë¡œì§
    (function() {
      let deferredPrompt = null;
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
      const dismissedKey = 'pwa-install-dismissed';

      // ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš° ë˜ëŠ” ì´ë¯¸ ê±°ì ˆí•œ ê²½ìš° í‘œì‹œ ì•ˆí•¨
      if (isStandalone || localStorage.getItem(dismissedKey)) {
        return;
      }

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // 2ì´ˆ í›„ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
        setTimeout(() => {
          const container = document.getElementById('pwa-install-prompt');
          if (container) container.style.display = 'block';
        }, 2000);
      });

      window.addEventListener('appinstalled', () => {
        const container = document.getElementById('pwa-install-prompt');
        if (container) container.style.display = 'none';
        console.log('[PWA] LinkBrain ì•±ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
      });

      // ì„¤ì¹˜ ë²„íŠ¼ í´ë¦­
      document.addEventListener('DOMContentLoaded', () => {
        const installBtn = document.getElementById('pwa-install-button');
        const dismissBtn = document.getElementById('pwa-dismiss-button');
        const container = document.getElementById('pwa-install-prompt');

        if (installBtn) {
          installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) {
              if (isIOS) {
                alert('Safariì—ì„œ ê³µìœ  ë²„íŠ¼(â†‘)ì„ ëˆ„ë¥´ê³  "í™ˆ í™”ë©´ì— ì¶”ê°€"ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
              }
              return;
            }

            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log('[PWA] ì„¤ì¹˜ ê²°ê³¼:', outcome);
            deferredPrompt = null;
            if (container) container.style.display = 'none';
          });
        }

        if (dismissBtn) {
          dismissBtn.addEventListener('click', () => {
            if (container) container.style.display = 'none';
            localStorage.setItem(dismissedKey, 'true');
          });
        }
      });
    })();
  </script>
</body>

</html>